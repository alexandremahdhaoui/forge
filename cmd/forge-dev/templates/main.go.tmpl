// Code generated by forge-dev. DO NOT EDIT.
// Source: forge-dev.yaml + spec.openapi.yaml
{{.ChecksumHeader}}

package {{.PackageName}}

import (
	"context"
	"fmt"

	"github.com/alexandremahdhaoui/forge/pkg/enginecli"
{{- if eq .EngineType "builder"}}
	"github.com/alexandremahdhaoui/forge/pkg/forge"
	"github.com/alexandremahdhaoui/forge/pkg/mcptypes"
{{- end}}
{{- if eq .EngineType "test-runner"}}
	"github.com/alexandremahdhaoui/forge/pkg/forge"
	"github.com/alexandremahdhaoui/forge/pkg/mcptypes"
{{- end}}
{{- if eq .EngineType "testenv-subengine"}}
	"github.com/alexandremahdhaoui/forge/pkg/engineframework"
{{- end}}
{{- if eq .EngineType "dependency-detector"}}
	"github.com/alexandremahdhaoui/forge/pkg/mcpserver"
{{- end}}
)

// Name is the engine name.
const Name = "{{.EngineName}}"

// Version information (set via ldflags during build).
var (
	Version        = "{{.Version}}"
	CommitSHA      = "unknown"
	BuildTimestamp = "unknown"
)

// main is the entry point for the {{.EngineName}} engine.
func main() {
	enginecli.Bootstrap(enginecli.Config{
		Name:           Name,
		Version:        Version,
		CommitSHA:      CommitSHA,
		BuildTimestamp: BuildTimestamp,
		RunCLI:         nil, // Generated engines are MCP-only
		RunMCP:         runMCPServer,
		DocsConfig:     docsConfig,
	})
}

// runMCPServer creates and runs the MCP server.
func runMCPServer() error {
{{- if eq .EngineType "builder"}}
	server, err := SetupMCPServer(Name, Version, {{.BuildFunc}})
{{- else if eq .EngineType "test-runner"}}
	server, err := SetupMCPServer(Name, Version, {{.RunFunc}})
{{- else if eq .EngineType "testenv-subengine"}}
	server, err := SetupMCPServer(Name, Version, {{.CreateFunc}}, {{.DeleteFunc}})
{{- else if eq .EngineType "dependency-detector"}}
	server, err := SetupMCPServerBase(Name, Version)
{{- end}}
	if err != nil {
		return fmt.Errorf("setting up MCP server: %w", err)
	}

	// Register docs MCP tools (docs-list, docs-get)
	if err := RegisterDocsMCPTools(server); err != nil {
		return fmt.Errorf("registering docs MCP tools: %w", err)
	}
{{- if eq .EngineType "dependency-detector"}}

	// Register detectDependencies tool
	registerDetectDependenciesTool(server)
{{- end}}

	if err := server.Run(context.Background()); err != nil {
		return fmt.Errorf("running MCP server: %w", err)
	}

	return nil
}
{{- if eq .EngineType "builder"}}

// {{.BuildFunc}} is the build function that must be implemented by the engine author.
// Signature: func(ctx context.Context, input mcptypes.BuildInput, spec *Spec) (*forge.Artifact, error)
// This is a placeholder - the actual implementation should be in a separate file.
var _ = func() BuildFunc {
	return func(_ context.Context, _ mcptypes.BuildInput, _ *Spec) (*forge.Artifact, error) {
		panic("{{.BuildFunc}} function not implemented - create a separate file with the implementation")
	}
}
{{- end}}
{{- if eq .EngineType "test-runner"}}

// {{.RunFunc}} is the run function that must be implemented by the engine author.
// Signature: func(ctx context.Context, input mcptypes.RunInput, spec *Spec) (*forge.TestReport, error)
// This is a placeholder - the actual implementation should be in a separate file.
var _ = func() TestRunnerFunc {
	return func(_ context.Context, _ mcptypes.RunInput, _ *Spec) (*forge.TestReport, error) {
		panic("{{.RunFunc}} function not implemented - create a separate file with the implementation")
	}
}
{{- end}}
{{- if eq .EngineType "testenv-subengine"}}

// {{.CreateFunc}} is the create function that must be implemented by the engine author.
// Signature: func(ctx context.Context, input engineframework.CreateInput, spec *Spec) (*engineframework.TestEnvArtifact, error)
// This is a placeholder - the actual implementation should be in a separate file.
var _ = func() CreateFunc {
	return func(_ context.Context, _ engineframework.CreateInput, _ *Spec) (*engineframework.TestEnvArtifact, error) {
		panic("{{.CreateFunc}} function not implemented - create a separate file with the implementation")
	}
}

// {{.DeleteFunc}} is the delete function that must be implemented by the engine author.
// Signature: func(ctx context.Context, input engineframework.DeleteInput, spec *Spec) error
// This is a placeholder - the actual implementation should be in a separate file.
var _ = func() DeleteFunc {
	return func(_ context.Context, _ engineframework.DeleteInput, _ *Spec) error {
		panic("{{.DeleteFunc}} function not implemented - create a separate file with the implementation")
	}
}
{{- end}}
{{- if eq .EngineType "dependency-detector"}}

// registerDetectDependenciesTool registers the detectDependencies MCP tool.
// This function must be implemented by the engine author in a separate file.
// The implementation should call mcpserver.RegisterTool with the appropriate handler.
var registerDetectDependenciesTool func(server *mcpserver.Server)
{{- end}}
